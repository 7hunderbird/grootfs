---
resources:
- name: grootfs-git-repo
  type: git
  source:
    uri: https://github.com/cloudfoundry/grootfs
    branch: master
    ignore_paths:
    - ci/pipeline.yml

- name: slack-alert
  type: slack-notification-docker
  source:
    url: {{slack-alert-url}}

- name: grootfs-tracker
  type: tracker
  source:
    tracker_url: https://www.pivotaltracker.com
    project_id: "1661239"
    token: {{garden-tracker-token}}

jobs:
- name: grootfs
  public: true
  plan:
  - get: grootfs-git-repo
    trigger: true
  - task: grootfs
    file: grootfs-git-repo/ci/tasks/grootfs.yml
    on_failure:
      put: slack-alert
      params:
        username: Thanos
        icon_url: http://www.comicsblend.com/wp-content/uploads/2013/04/thanos.jpg
        channel: "#garden"
        text: "<!subteam^S1U0HSJ9E|grootfsteam>: I've destroyed your build. Come and get me!"
  - put: grootfs-tracker
    params:
      repos:
      - grootfs-git-repo


resource_types:
- name: slack-notification-docker
  type: docker-image
  source:
    repository: cfcommunity/slack-notification-resource
